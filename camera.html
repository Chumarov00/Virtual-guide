<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>AR ‚Äî –í–∏–¥–µ–æ –ø–æ –º–µ—Ç–∫–∞–º23</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>

  <!-- A-Frame + MindAR (–∫–∞–∫ –≤ —Ç–≤–æ—ë–º —Ä–∞–±–æ—á–µ–º —Ñ–∞–π–ª–µ) -->
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

  <style>
    /* =========================================================
      [–°–¢–ò–õ–ò] –ë–∞–∑–∞
    ========================================================= */
    html, body { margin:0; padding:0; width:100%; height:100%; overflow:hidden; background:#000; }
    #ar { position:fixed; inset:0; }

    /* =========================================================
      [–°–¢–ò–õ–ò] –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å: –ù–∞–∑–∞–¥ + –°—Ç–∞—Ç—É—Å
      –í–ê–ñ–ù–û: z-index –±–æ–ª—å—à–µ —á–µ–º —É –≤–∏–¥–µ–æ, —á—Ç–æ–±—ã "–ù–∞–∑–∞–¥" –≤—Å–µ–≥–¥–∞ –±—ã–ª –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–π
    ========================================================= */
    .topBar{
      position:fixed; left:12px; right:12px; top:12px; z-index:10050;
      display:flex; gap:10px; align-items:center;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      pointer-events:auto;
    }
    .pillBtn{
      display:inline-flex; align-items:center; justify-content:center;
      padding:10px 12px; border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(0,0,0,.45); backdrop-filter: blur(10px);
      color:rgba(255,255,255,.92); text-decoration:none;
      font-weight:900; font-size:13px; user-select:none;
    }
    .status{
      flex:1; padding:10px 12px; border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(0,0,0,.45); backdrop-filter: blur(10px);
      color:rgba(255,255,255,.92);
      text-align:center; font-weight:850; font-size:12px;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }

    /* =========================================================
      [–ù–û–í–û–ï] –ü–æ–¥—Å–∫–∞–∑–∫–∞ –ø–æ–≤–æ—Ä–æ—Ç–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
      - –ù–ï –±–ª–æ–∫–∏—Ä—É–µ—Ç –∫–ª–∏–∫–∏ (pointer-events:none)
      - –ù–∏–∂–µ topBar –ø–æ z-index (—á—Ç–æ–±—ã "–ù–∞–∑–∞–¥" –≤—Å–µ–≥–¥–∞ –Ω–∞–∂–∏–º–∞–ª—Å—è)
    ========================================================= */
    #rotateHint{
      position:fixed; inset:0; z-index:10020;
      display:none; align-items:center; justify-content:center;
      background:rgba(0,0,0,.55);
      pointer-events:none;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    .rotateCard{
      width:min(520px, 92vw);
      border-radius:18px;
      padding:16px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(16,18,24,.75);
      backdrop-filter: blur(12px);
      color:#fff;
      text-align:center;
    }
    .rotateIcon{
      width:64px; height:64px;
      margin:0 auto 10px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.14);
      background:
        radial-gradient(120px 60px at 30% 30%, rgba(74,168,255,.35), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.04));
      display:flex; align-items:center; justify-content:center;
      font-size:30px;
    }
    .rotateTitle{ font-weight:950; font-size:15px; margin:0 0 6px; }
    .rotateText{ opacity:.85; font-size:13px; line-height:1.35; }

    /* =========================================================
      [–°–¢–ò–õ–ò] –û–≤–µ—Ä–ª–µ–π –∑–∞–ø—É—Å–∫–∞ (–æ–¥–Ω–∞ –∫–Ω–æ–ø–∫–∞)
    ========================================================= */
    #startOverlay{
      position:fixed; inset:0; z-index:9998;
      display:flex; align-items:center; justify-content:center;
      background: rgba(11,12,15,0.85);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    .panel{
      width:min(720px, 92vw);
      border-radius:16px;
      padding:18px;
      background:#17191f;
      box-shadow:0 10px 30px rgba(0,0,0,0.55);
      border:1px solid rgba(255,255,255,.10);
      color:#fff;
    }
    .panel h3{ margin:0 0 8px; font-size:18px; }
    .panel p{ margin:0 0 14px; opacity:.85; font-size:13px; line-height:1.35; }

    .actions{ display:flex; gap:12px; justify-content:flex-end; flex-wrap:wrap; }
    button{
      border:0; padding:11px 14px; border-radius:12px; font-weight:800; cursor:pointer;
      font-family: inherit;
    }
    .ghost{ background:#31394a; color:#fff; }
    .primary{ background:#4aa8ff; color:#001525; }

    /* =========================================================
      [–°–¢–ò–õ–ò] –û–∫–Ω–æ –≤–∏–¥–µ–æ (–º–∞–ª–µ–Ω—å–∫–æ–µ, —Å–Ω–∏–∑—É) ‚Äî –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    ========================================================= */
    #videoDock{
      position:fixed;
      left:12px; right:12px;
      bottom:12px;
      z-index:10030; /* –Ω–∏–∂–µ topBar, –Ω–æ –≤—ã—à–µ AR */
      max-width:560px;
      margin:0 auto;

      border-radius:18px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(0,0,0,.40);
      backdrop-filter: blur(10px);
      box-shadow:0 18px 46px rgba(0,0,0,.40);

      display:none; /* –≤–∫–ª—é—á–∏–º —á–µ—Ä–µ–∑ JS, –∫–æ–≥–¥–∞ –±—É–¥–µ—Ç –Ω–∞–π–¥–µ–Ω–æ –≤–∏–¥–µ–æ */
    }
    #videoHeader{
      display:flex; justify-content:space-between; gap:10px;
      padding:10px 12px;
      border-bottom:1px solid rgba(255,255,255,.10);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:rgba(255,255,255,.92);
    }
    #videoTitle{ font-weight:950; font-size:13px; }
    #videoHint{ font-weight:800; font-size:12px; color:rgba(180,220,255,.95); }

    #arVideo{
      width:100%;
      height:190px;
      display:block;
      background:#000;
      object-fit:cover;
      opacity: 1; /* –±—É–¥–µ—Ç –º–µ–Ω—è—Ç—å—Å—è –ø–æ–ª–∑—É–Ω–∫–æ–º */
    }

    @media (max-width: 420px){
      #arVideo{ height:170px; }
    }

    /* =========================================================
      [–ù–û–í–û–ï] –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º –≤–∏–¥–µ–æ (—á–µ—Ä–µ–∑ –∫–ª–∞—Å—Å .isFull)
      –í–∞–∂–Ω–æ: –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º requestFullscreen(), —Ç–æ–ª—å–∫–æ CSS.
    ========================================================= */
    #videoDock.isFull{
      left:0; right:0; top:0; bottom:0;
      max-width:none;
      margin:0;
      border-radius:0;
      background:#000;
      backdrop-filter:none;
      box-shadow:none;
    }

    /* [–ù–û–í–û–ï] –£–±–∏—Ä–∞–µ–º –Ω–∏–∂–Ω—é—é –Ω–∞–¥–ø–∏—Å—å/–ø–∞–Ω–µ–ª—å –ø—Ä–∏ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–º –≤–∏–¥–µ–æ */
    #videoDock.isFull #videoHeader{
      display: none !important;
    }

    #videoDock.isFull #arVideo{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      object-fit:contain;
    }

    /* =========================================================
      [–ù–û–í–û–ï] –ü–æ–ª–∑—É–Ω–æ–∫ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ (—Å–ø—Ä–∞–≤–∞)
      - –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –≤–∏–¥–µ–æ –≤–∫–ª—é—á–µ–Ω–æ
========================================================= */
    #opacityControl{
      position: fixed;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      z-index: 10060; /* –≤—ã—à–µ videoDock –∏ –≤—ã—à–µ –≤—Å–µ–≥–æ */
      display: none;  /* –ø–æ–∫–∞–∂–µ–º —á–µ—Ä–µ–∑ JS */
      padding: 12px 10px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.45);
      backdrop-filter: blur(10px);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: rgba(255,255,255,.92);
      user-select: none;
    }

    #opacityLabel{
      font-size: 12px;
      font-weight: 900;
      text-align: center;
      margin-bottom: 10px;
      opacity: .9;
    }

    /* –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π –ø–æ–ª–∑—É–Ω–æ–∫ (—á–µ—Ä–µ–∑ –ø–æ–≤–æ—Ä–æ—Ç) */
    #opacitySlider{
      width: 220px;     /* —Å—Ç–∞–Ω–µ—Ç "–≤—ã—Å–æ—Ç–æ–π" –ø–æ—Å–ª–µ rotate */
      height: 28px;
      transform: rotate(-90deg);
      transform-origin: center;
      cursor: pointer;
    }

    #opacityMinMax{
      margin-top: 10px;
      display: flex;
      justify-content: space-between;
      font-size: 11px;
      opacity: .75;
    }
  </style>
</head>

<body>

  <!-- =========================================================
    [UI] –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å
  ========================================================= -->
  <div class="topBar">
    <a class="pillBtn" href="./index.html">‚Üê –ù–∞–∑–∞–¥</a>
    <div class="status" id="status">–ù–∞–∂–º–∏—Ç–µ ¬´–ó–∞–ø—É—Å—Ç–∏—Ç—å AR¬ª</div>
  </div>

  <!-- =========================================================
    [UI] –ü–æ–¥—Å–∫–∞–∑–∫–∞ –ø–æ–≤–æ—Ä–æ—Ç–∞ (—Ç–µ–ª–µ—Ñ–æ–Ω, –ø–æ—Ä—Ç—Ä–µ—Ç)
  ========================================================= -->
  <div id="rotateHint" aria-hidden="true">
    <div class="rotateCard">
      <div class="rotateIcon">üì±‚Üª</div>
      <div class="rotateTitle">–ü–æ–≤–µ—Ä–Ω–∏ —Ç–µ–ª–µ—Ñ–æ–Ω –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ</div>
      <div class="rotateText">–¢–∞–∫ –º–µ—Ç–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞—ë—Ç—Å—è —Å—Ç–∞–±–∏–ª—å–Ω–µ–µ, –∞ –≤–∏–¥–µ–æ —É–¥–æ–±–Ω–µ–µ —Å–º–æ—Ç—Ä–µ—Ç—å.</div>
    </div>
  </div>

  <!-- =========================================================
    [UI] –û–≤–µ—Ä–ª–µ–π –∑–∞–ø—É—Å–∫–∞ (–æ–¥–Ω–∞ –∫–Ω–æ–ø–∫–∞)
  ========================================================= -->
  <div id="startOverlay">
    <div class="panel">
      <h3>–ó–∞–ø—É—Å–∫ AR</h3>
      <p>
        –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É, —Ä–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ –∏ –Ω–∞–≤–µ–¥–∏—Ç–µ –Ω–∞ –º–µ—Ç–∫—É/—Ñ–æ—Ç–æ –∑–¥–∞–Ω–∏—è.
        <br><span style="opacity:.75">–í–∏–¥–µ–æ –±—É–¥–µ—Ç –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω.</span>
      </p>
      <div class="actions">
        <button class="ghost" id="reloadBtn" type="button">–û–±–Ω–æ–≤–∏—Ç—å</button>
        <button class="primary" id="startBtn" type="button">–ó–∞–ø—É—Å—Ç–∏—Ç—å AR</button>
      </div>
      <p style="margin-top:10px; font-size:12px; opacity:.65">
        –ï—Å–ª–∏ –±—É–¥–µ—Ç —á—ë—Ä–Ω—ã–π —ç–∫—Ä–∞–Ω ‚Äî —á–∞—â–µ –≤—Å–µ–≥–æ –∫–∞–º–µ—Ä–∞ –∑–∞–Ω—è—Ç–∞ –¥—Ä—É–≥–æ–π –≤–∫–ª–∞–¥–∫–æ–π/–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º.
      </p>
    </div>
  </div>

  <!-- =========================================================
    [UI] –û–∫–Ω–æ –≤–∏–¥–µ–æ (–±—É–¥–µ—Ç –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–º)
  ========================================================= -->
  <div id="videoDock">
    <div id="videoHeader">
      <div id="videoTitle">–í–∏–¥–µ–æ</div>
      <div id="videoHint">–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ‚Ä¶</div>
    </div>
    <video id="arVideo" playsinline webkit-playsinline muted controls></video>
  </div>

  <!-- =========================================================
    [UI] –ü–æ–ª–∑—É–Ω–æ–∫ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ (—Å–ø—Ä–∞–≤–∞)
  ========================================================= -->
  <div id="opacityControl" aria-label="–†–µ–≥—É–ª–∏—Ä–æ–≤–∫–∞ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ –≤–∏–¥–µ–æ">
    <div id="opacityLabel">–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å</div>
    <input id="opacitySlider" type="range" min="20" max="100" value="100" step="1" />
    <div id="opacityMinMax">
      <span>20%</span>
      <span>100%</span>
    </div>
  </div>

  <!-- =========================================================
    [AR] A-Frame —Å—Ü–µ–Ω–∞
  ========================================================= -->
  <div id="ar">
    <a-scene
      id="scene"
      mindar-image="imageTargetSrc: ./targets.mind; autoStart: false; uiScanning: false; uiError: false;"
      renderer="colorManagement: true; physicallyCorrectLights: true; antialias: true"
      vr-mode-ui="enabled: false"
      device-orientation-permission-ui="enabled: true"
      embedded>

      <a-entity light="type: hemisphere; intensity: 0.9"></a-entity>
      <a-entity light="type: directional; intensity: 0.9" position="1 2 1"></a-entity>

      <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

      <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä: —Å—é–¥–∞ JS –¥–æ–±–∞–≤–∏—Ç 25 targets (0..24) -->
      <a-entity id="targetsRoot"></a-entity>
    </a-scene>
  </div>

  <script>
    /* =========================================================
      [–ù–ê–°–¢–†–û–ô–ö–ò] 1) –ì–¥–µ –ª–µ–∂–∏—Ç targets.mind
    ========================================================= */
    const TARGETS_PATH = "./targets.mind";

    /* =========================================================
      [–ù–ê–°–¢–†–û–ô–ö–ò] 2) –í–∏–¥–µ–æ –∏ –¥–∏–∞–ø–∞–∑–æ–Ω—ã –º–µ—Ç–æ–∫
      0..7   -> bulygin
      8..14  -> naumov
      15..24 -> pchelin
    ========================================================= */
    const VIDEO_URLS = {
      bulygin: "https://chumarov00.github.io/Virtual-guide/Bulygin%27s%20House.mp4",
      naumov:  "https://chumarov00.github.io/Virtual-guide/Naumov%27s%20house.mp4",
      pchelin: "https://chumarov00.github.io/Virtual-guide/Pchelin%27s%20House.MP4"
    };

    function groupByIndex(i){
      if (i >= 0 && i <= 7) return "bulygin";
      if (i >= 8 && i <= 14) return "naumov";
      if (i >= 15 && i <= 24) return "pchelin";
      return null;
    }

    /* =========================================================
      [DOM] –≠–ª–µ–º–µ–Ω—Ç—ã UI
    ========================================================= */
    const statusEl = document.getElementById("status");
    const startOverlay = document.getElementById("startOverlay");
    const startBtn = document.getElementById("startBtn");
    const reloadBtn = document.getElementById("reloadBtn");

    const rotateHint = document.getElementById("rotateHint");

    const videoDock  = document.getElementById("videoDock");
    const videoTitle = document.getElementById("videoTitle");
    const videoHint  = document.getElementById("videoHint");
    const videoEl    = document.getElementById("arVideo");

    const opacityControl = document.getElementById("opacityControl");
    const opacitySlider  = document.getElementById("opacitySlider");

    const sceneEl = document.getElementById("scene");
    const targetsRoot = document.getElementById("targetsRoot");

    function setStatus(t){ statusEl.textContent = t; }

    /* =========================================================
      [–ù–û–í–û–ï] –ü–æ–¥—Å–∫–∞–∑–∫–∞ –ø–æ–≤–æ—Ä–æ—Ç–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
      - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ/–ø–ª–∞–Ω—à–µ—Ç–µ (pointer: coarse)
      - –∏ —Ç–æ–ª—å–∫–æ –≤ –ø–æ—Ä—Ç—Ä–µ—Ç–µ
      - –∏ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞ AR
    ========================================================= */
    let arStartedOnce = false;

    function isMobileLike(){
      return window.matchMedia && window.matchMedia("(pointer: coarse)").matches;
    }

    function isPortrait(){
      if (window.matchMedia) return window.matchMedia("(orientation: portrait)").matches;
      return window.innerHeight > window.innerWidth;
    }

    function updateRotateHint(){
      if (!rotateHint) return;

      if (!arStartedOnce){
        rotateHint.style.display = "none";
        return;
      }

      if (isMobileLike() && isPortrait()){
        rotateHint.style.display = "flex";
      } else {
        rotateHint.style.display = "none";
      }
    }

    window.addEventListener("resize", updateRotateHint);
    window.addEventListener("orientationchange", updateRotateHint);

    /* =========================================================
      [–ù–û–í–û–ï] –ü–æ–ª–∑—É–Ω–æ–∫ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏: –º–µ–Ω—è–µ—Ç opacity –≤–∏–¥–µ–æ
      20..100 -> 0.2..1.0
    ========================================================= */
    opacitySlider.addEventListener("input", () => {
      const alpha = Number(opacitySlider.value) / 100;
      videoEl.style.opacity = String(alpha);
    });

    /* =========================================================
      [–õ–û–ì–ò–ö–ê] –°–æ–∑–¥–∞–Ω–∏–µ target-entity 0..24
    ========================================================= */
    function buildTargets(){
      targetsRoot.innerHTML = "";

      for(let i=0; i<=24; i++){
        const holder = document.createElement("a-entity");
        holder.setAttribute("mindar-image-target", `targetIndex: ${i}`);

        holder.addEventListener("targetFound", () => onFound(i));
        holder.addEventListener("targetLost",  () => onLost(i));

        targetsRoot.appendChild(holder);
      }
    }

    /* =========================================================
      [–õ–û–ì–ò–ö–ê] –í–∏–¥–µ–æ-—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
      - –ø—Ä–∏ –Ω–∞–π–¥–µ–Ω–Ω–æ–π –º–µ—Ç–∫–µ —Å—Ç–∞–≤–∏–º –Ω—É–∂–Ω—ã–π mp4 –∏ –∑–∞–ø—É—Å–∫–∞–µ–º
      - –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ –º–µ—Ç–∫–∏ –ù–ï –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º
      - –ù–û–í–û–ï: –≤–∏–¥–µ–æ –¥–µ–ª–∞–µ–º –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–º —á–µ—Ä–µ–∑ CSS –∫–ª–∞—Å—Å
      - –ù–û–í–û–ï: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª–∑—É–Ω–æ–∫ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏
    ========================================================= */
    let currentIndex = null;

    async function onFound(idx){
      const group = groupByIndex(idx);
      if(!group){
        setStatus(`–ù–∞–π–¥–µ–Ω–∞ –º–µ—Ç–∫–∞ #${idx}, –Ω–æ –Ω–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ –≤–∏–¥–µ–æ`);
        return;
      }

      const src = VIDEO_URLS[group];
      currentIndex = idx;

      // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–∏–¥–µ–æ + –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º
      videoDock.style.display = "block";
      videoDock.classList.add("isFull");

      // —Å–∫—Ä—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É –ø–æ–≤–æ—Ä–æ—Ç–∞ (–≤–∏–¥–µ–æ —É–∂–µ –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω ‚Äî –º–æ–∂–Ω–æ —É–±—Ä–∞—Ç—å)
      if (rotateHint) rotateHint.style.display = "none";

      // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª–∑—É–Ω–æ–∫ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏
      opacityControl.style.display = "block";

      // —Å–±—Ä–æ—Å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
      opacitySlider.value = "100";
      videoEl.style.opacity = "1";

      // –ø–æ–¥–ø–∏—Å–∏ (–Ω–µ –≤–∏–¥–Ω—ã –≤ fullscreen, –Ω–æ –æ—Å—Ç–∞–≤–∏–º –¥–ª—è –ª–æ–≥–∏–∫–∏/–±—É–¥—É—â–µ–≥–æ)
      videoTitle.textContent = `–í–∏–¥–µ–æ: ${group} (–º–µ—Ç–∫–∞ #${idx})`;
      videoHint.textContent  = "–ú–µ—Ç–∫–∞ –Ω–∞–π–¥–µ–Ω–∞";

      // –ï—Å–ª–∏ —É–∂–µ –∏–≥—Ä–∞–µ—Ç —Ç–æ –∂–µ –≤–∏–¥–µ–æ ‚Äî –Ω–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º
      // videoEl.src –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –∞–±—Å–æ–ª—é—Ç–Ω—ã–π URL => –ø—Ä–æ–≤–µ—Ä—è–µ–º includes
      if (videoEl.src && videoEl.src.includes(src) && !videoEl.paused){
        setStatus(`–ú–µ—Ç–∫–∞ #${idx} ‚Äî –ø—Ä–æ–¥–æ–ª–∂–∞—é –≤–∏–¥–µ–æ`);
        return;
      }

      // –ú–µ–Ω—è–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫
      videoEl.src = src;

      // –ü–æ–ø—Ä–æ–±—É–µ–º autoplay (muted –ø–æ–º–æ–≥–∞–µ—Ç)
      try{
        await videoEl.play();
        setStatus(`–ú–µ—Ç–∫–∞ #${idx} ‚Äî –≤–∏–¥–µ–æ –∏–≥—Ä–∞–µ—Ç`);
      }catch(e){
        setStatus(`–ú–µ—Ç–∫–∞ #${idx} ‚Äî –Ω–∞–∂–º–∏ Play (–∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω)`);
        console.error(e);
      }
    }

    function onLost(idx){
      if (idx === currentIndex){
        setStatus(`–ú–µ—Ç–∫–∞ #${idx} –ø–æ—Ç–µ—Ä—è–Ω–∞ ‚Äî –≤–∏–¥–µ–æ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è`);
      }
      // –ù–ò–ß–ï–ì–û –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º
    }

    /* =========================================================
      [–õ–û–ì–ò–ö–ê] –ó–∞–ø—É—Å–∫ MindAR
    ========================================================= */
    async function checkTargetsFile(){
      sceneEl.setAttribute(
        "mindar-image",
        `imageTargetSrc: ${TARGETS_PATH}; autoStart: false; uiScanning: false; uiError: false;`
      );

      try{
        const r = await fetch(TARGETS_PATH, { cache: "no-store" });
        if(!r.ok){
          throw new Error(`targets.mind –Ω–µ –Ω–∞–π–¥–µ–Ω: HTTP ${r.status}`);
        }
        return true;
      }catch(e){
        setStatus("targets.mind –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è ‚Äî –ø—Ä–æ–≤–µ—Ä—å –ø—É—Ç—å –∏ GitHub Pages");
        alert("targets.mind –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –æ–Ω –ª–µ–∂–∏—Ç —Ä—è–¥–æ–º —Å camera.html –∏ –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ HTTPS.");
        console.error(e);
        return false;
      }
    }

    async function startAR(){
      const ok = await checkTargetsFile();
      if(!ok) return;

      buildTargets();

      const mindar = sceneEl.systems["mindar-image-system"];
      if(!mindar){
        setStatus("MindAR system –Ω–µ –Ω–∞–π–¥–µ–Ω (–æ—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è MindAR)");
        alert("MindAR system –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ mindar-image-aframe.prod.js");
        return;
      }

      try{
        setStatus("–ó–∞–ø—É—Å–∫ –∫–∞–º–µ—Ä—ã‚Ä¶");
        await mindar.start();
        setStatus("–ö–∞–º–µ—Ä–∞ –∑–∞–ø—É—â–µ–Ω–∞ ‚Äî –Ω–∞–≤–µ–¥–∏ –Ω–∞ –º–µ—Ç–∫—É");
        startOverlay.style.display = "none";

        // –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É –ø–æ–≤–æ—Ä–æ—Ç–∞ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ
        arStartedOnce = true;
        updateRotateHint();
      }catch(e){
        setStatus(`–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–∞–º–µ—Ä—É: ${e?.name || "–æ—à–∏–±–∫–∞"}`);
        alert("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–∞–º–µ—Ä—É/AR. –ü—Ä–æ–≤–µ—Ä—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∏ —á—Ç–æ –∫–∞–º–µ—Ä–∞ –Ω–µ –∑–∞–Ω—è—Ç–∞ –¥—Ä—É–≥–æ–π –≤–∫–ª–∞–¥–∫–æ–π/–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º.");
        console.error(e);
      }
    }

    /* =========================================================
      [–°–û–ë–´–¢–ò–Ø UI]
    ========================================================= */
    reloadBtn.addEventListener("click", () => location.reload());
    startBtn.addEventListener("click", startAR);

    // –ù–∞ —Å—Ç–∞—Ä—Ç–µ ‚Äî –ø—Ä–æ—Å—Ç–æ —Å—Ç–∞—Ç—É—Å
    setStatus("–ù–∞–∂–º–∏—Ç–µ ¬´–ó–∞–ø—É—Å—Ç–∏—Ç—å AR¬ª");
  </script>
</body>
</html>
