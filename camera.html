<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>AR ‚Äî –í–∏–¥–µ–æ –ø–æ –º–µ—Ç–∫–∞–º</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no" />

  <!-- A-Frame + MindAR (–ø–æ—Ä—è–¥–æ–∫ –≤–∞–∂–µ–Ω) -->
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

  <style>
    /* =========================================================
      (1) –ë–ê–ó–ê –°–¢–†–ê–ù–ò–¶–´
    ========================================================= */
    html, body{
      margin:0; padding:0; width:100%; height:100%;
      overflow:hidden; background:#000;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }

    /* A-Frame —Å—Ü–µ–Ω–∞ ‚Äî –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω */
    a-scene{
      position:fixed;
      inset:0;
      width:100%;
      height:100%;
      z-index:0;
    }

    /* =========================================================
      (2) –í–ï–†–•–ù–Ø–Ø –ü–ê–ù–ï–õ–¨: –ù–ê–ó–ê–î + –°–¢–ê–¢–£–°
      –í–∞–∂–Ω–æ: –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤—ã—à–µ –≤—Å–µ—Ö –æ–≤–µ—Ä–ª–µ–µ–≤, —á—Ç–æ–±—ã –≤—Å–µ–≥–¥–∞ –Ω–∞–∂–∏–º–∞–ª–∞—Å—å.
    ========================================================= */
    .topBar{
      position:fixed;
      left:12px; right:12px; top:12px;
      z-index:10050;
      display:flex; gap:10px; align-items:center;
      pointer-events:auto;
    }
    .pillBtn{
      display:inline-flex;
      align-items:center; justify-content:center;
      padding:10px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(0,0,0,.45);
      backdrop-filter: blur(10px);
      color:rgba(255,255,255,.92);
      text-decoration:none;
      font-weight:900;
      font-size:13px;
      user-select:none;
    }
    .status{
      flex:1;
      padding:10px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(0,0,0,.45);
      backdrop-filter: blur(10px);
      color:rgba(255,255,255,.92);
      text-align:center;
      font-weight:850;
      font-size:12px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    /* =========================================================
      (3) –û–í–ï–†–õ–ï–ô –°–¢–ê–†–¢–ê (–∫–Ω–æ–ø–∫–∞ –∑–∞–ø—É—Å–∫–∞ ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ –¥–ª—è –∫–∞–º–µ—Ä—ã)
    ========================================================= */
    .startOverlay{
      position:fixed;
      inset:0;
      z-index:10000;
      display:flex;
      align-items:center;
      justify-content:center;
      background: rgba(11,12,15,.85);
      pointer-events:auto;
    }
    .panel{
      width:min(720px, 92vw);
      border-radius:16px;
      padding:18px;
      background:#17191f;
      border:1px solid rgba(255,255,255,.10);
      box-shadow:0 10px 30px rgba(0,0,0,.55);
      color:#fff;
    }
    .panel h3{
      margin:0 0 8px;
      font-size:18px;
      font-weight:950;
    }
    .panel p{
      margin:0 0 14px;
      opacity:.85;
      font-size:13px;
      line-height:1.35;
    }
    .actions{
      display:flex;
      gap:12px;
      justify-content:flex-end;
      flex-wrap:wrap;
    }
    .btn{
      border:0;
      padding:11px 14px;
      border-radius:12px;
      font-weight:900;
      cursor:pointer;
      font-family: inherit;
    }
    .btn.ghost{ background:#31394a; color:#fff; }
    .btn.primary{ background:#4aa8ff; color:#001525; }
    .note{
      margin-top:10px;
      font-size:12px;
      opacity:.65;
    }
    .muted{ opacity:.75; }

    /* =========================================================
      (4) –ü–û–î–°–ö–ê–ó–ö–ê –ü–û–í–û–†–û–¢–ê –¢–ï–õ–ï–§–û–ù–ê (—Ç–æ–ª—å–∫–æ –º–æ–±–∏–ª—å–Ω—ã–π –ø–æ—Ä—Ç—Ä–µ—Ç)
      –í–∞–∂–Ω–æ: –ù–ï –±–ª–æ–∫–∏—Ä—É–µ–º ‚Äú–ù–∞–∑–∞–¥‚Äù ‚Äî –ø–æ—ç—Ç–æ–º—É z-index –Ω–∏–∂–µ topBar.
    ========================================================= */
    .rotateHint{
      position:fixed;
      inset:0;
      z-index:10020;           /* –Ω–∏–∂–µ topBar (10050), –Ω–æ –≤—ã—à–µ —Å—Ü–µ–Ω—ã */
      display:none;            /* –≤–∫–ª—é—á–∞–µ–º —á–µ—Ä–µ–∑ JS */
      align-items:center;
      justify-content:center;
      background: rgba(0,0,0,.55);
      pointer-events:none;     /* —á—Ç–æ–±—ã –Ω–µ –º–µ—à–∞–ª–∞ –Ω–∞–∂–∞—Ç–∏—é –∫–Ω–æ–ø–æ–∫ */
    }
    .rotateHint__card{
      width:min(520px, 92vw);
      border-radius:18px;
      padding:16px 16px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(16,18,24,.75);
      backdrop-filter: blur(12px);
      color:#fff;
      text-align:center;
      pointer-events:none;
    }
    .rotateHint__icon{
      width:64px; height:64px;
      margin:0 auto 10px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.14);
      background: radial-gradient(120px 60px at 30% 30%, rgba(74,168,255,.35), transparent 60%),
                  linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.04));
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:30px;
    }
    .rotateHint__title{
      font-weight:950;
      font-size:15px;
      margin:0 0 6px;
    }
    .rotateHint__text{
      margin:0;
      opacity:.85;
      font-size:13px;
      line-height:1.35;
    }

    /* =========================================================
      (5) –ü–û–õ–ù–û–≠–ö–†–ê–ù–ù–û–ï –í–ò–î–ï–û (–ø–æ–≤–µ—Ä—Ö –∫–∞–º–µ—Ä—ã)
      - –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ targetFound
      - –ù–ï –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ targetLost
      - controls –æ—Å—Ç–∞–≤–ª—è–µ–º (–µ—Å–ª–∏ autoplay –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω ‚Äî –Ω–∞–∂–º—É—Ç Play)
    ========================================================= */
    .videoFull{
      position:fixed;
      inset:0;
      z-index:10030;          /* –≤—ã—à–µ rotateHint, –Ω–∏–∂–µ topBar */
      display:none;
      background:#000;
    }

    .videoFull.isOpen{
      display:block;
    }

    /* –°–∞–º–æ –≤–∏–¥–µ–æ –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω */
    #arVideo{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      object-fit: contain;    /* —á—Ç–æ–±—ã –Ω–µ –æ–±—Ä–µ–∑–∞—Ç—å –≤–∏–¥–µ–æ */
      background:#000;
    }

    /* –ú–∞–ª–µ–Ω—å–∫–∞—è –ø–ª–∞—à–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–≤–µ—Ä—Ö –≤–∏–¥–µ–æ */
    .videoLabel{
      position:absolute;
      left:12px; right:12px;
      bottom:12px;
      margin:0 auto;
      max-width:740px;
      z-index:2;
      border-radius:14px;
      padding:10px 12px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(0,0,0,.45);
      backdrop-filter: blur(10px);
      color:rgba(255,255,255,.92);
      font-size:12px;
      font-weight:850;
      display:flex;
      justify-content:space-between;
      gap:12px;
      pointer-events:none;
    }
    .videoLabel b{ font-weight:950; }
  </style>
</head>

<body>

  <!-- =========================================================
    (A) –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å ‚Äî –≤—Å–µ–≥–¥–∞ —Å–≤–µ—Ä—Ö—É
  ========================================================= -->
  <div class="topBar">
    <!-- ‚Äú–ù–∞–∑–∞–¥‚Äù —Ä–∞–±–æ—Ç–∞–µ—Ç –≤—Å–µ–≥–¥–∞, –¥–∞–∂–µ –∫–æ–≥–¥–∞ –≤–∏–¥–µ–æ –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω -->
    <a class="pillBtn" id="backBtn" href="./index.html">‚Üê –ù–∞–∑–∞–¥</a>
    <div class="status" id="status">–ù–∞–∂–º–∏—Ç–µ ¬´–ó–∞–ø—É—Å—Ç–∏—Ç—å AR¬ª</div>
  </div>

  <!-- =========================================================
    (B) –û–≤–µ—Ä–ª–µ–π –∑–∞–ø—É—Å–∫–∞
  ========================================================= -->
  <div class="startOverlay" id="startOverlay">
    <div class="panel">
      <h3>–ó–∞–ø—É—Å–∫ AR</h3>
      <p>
        –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É, —Ä–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ –∏ –Ω–∞–≤–µ–¥–∏—Ç–µ –Ω–∞ –º–µ—Ç–∫—É/—Ñ–æ—Ç–æ –∑–¥–∞–Ω–∏—è.
        <br><span class="muted">–í–∏–¥–µ–æ –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω.</span>
      </p>

      <div class="actions">
        <button class="btn ghost" id="reloadBtn" type="button">–û–±–Ω–æ–≤–∏—Ç—å</button>
        <button class="btn primary" id="startBtn" type="button">–ó–∞–ø—É—Å—Ç–∏—Ç—å AR</button>
      </div>

      <div class="note">
        –ï—Å–ª–∏ —á—ë—Ä–Ω—ã–π —ç–∫—Ä–∞–Ω ‚Äî —á–∞—Å—Ç–æ –∫–∞–º–µ—Ä–∞ –∑–∞–Ω—è—Ç–∞ –¥—Ä—É–≥–æ–π –≤–∫–ª–∞–¥–∫–æ–π/–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º.
      </div>
    </div>
  </div>

  <!-- =========================================================
    (C) –ü–æ–¥—Å–∫–∞–∑–∫–∞ –ø–æ–≤–æ—Ä–æ—Ç–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–≤–∫–ª—é—á–∞–µ—Ç—Å—è JS-–æ–º)
  ========================================================= -->
  <div class="rotateHint" id="rotateHint" aria-hidden="true">
    <div class="rotateHint__card">
      <div class="rotateHint__icon">üì±‚Üª</div>
      <div class="rotateHint__title">–ü–æ–≤–µ—Ä–Ω–∏ —Ç–µ–ª–µ—Ñ–æ–Ω –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ</div>
      <p class="rotateHint__text">
        –¢–∞–∫ –º–µ—Ç–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞—ë—Ç—Å—è —Å—Ç–∞–±–∏–ª—å–Ω–µ–µ, –∞ –≤–∏–¥–µ–æ –±—É–¥–µ—Ç —É–¥–æ–±–Ω–µ–µ —Å–º–æ—Ç—Ä–µ—Ç—å.
      </p>
    </div>
  </div>

  <!-- =========================================================
    (D) –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–µ –≤–∏–¥–µ–æ (–ø–æ–≤–µ—Ä—Ö –∫–∞–º–µ—Ä—ã)
  ========================================================= -->
  <div class="videoFull" id="videoFull">
    <video id="arVideo" playsinline webkit-playsinline muted controls></video>

    <div class="videoLabel" id="videoLabel">
      <div id="videoTitle"><b>–í–∏–¥–µ–æ</b></div>
      <div id="videoHint">–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ‚Ä¶</div>
    </div>
  </div>

  <!-- =========================================================
    (E) AR-—Å—Ü–µ–Ω–∞ (–∫–∞–º–µ—Ä–∞ + —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ)
    targets.mind –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ HTTPS –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É –ø—É—Ç–∏
  ========================================================= -->
  <a-scene
    id="scene"
    embedded
    vr-mode-ui="enabled:false"
    device-orientation-permission-ui="enabled:true"
    renderer="colorManagement:true; physicallyCorrectLights:true; antialias:true"
    mindar-image="imageTargetSrc: ./targets.mind; autoStart:false; uiScanning:false; uiError:false;"
  >
    <a-entity light="type: hemisphere; intensity: 0.9"></a-entity>
    <a-entity light="type: directional; intensity: 0.9" position="1 2 1"></a-entity>

    <a-camera position="0 0 0" look-controls="enabled:false"></a-camera>

    <!-- –°—é–¥–∞ JS –¥–æ–±–∞–≤–∏—Ç 25 —Ü–µ–ª–µ–π targetIndex: 0..24 -->
    <a-entity id="targetsRoot"></a-entity>
  </a-scene>

  <script>
    /* =========================================================
      (1) –ù–ê–°–¢–†–û–ô–ö–ò: targets.mind
      –ï—Å–ª–∏ targets.mind —Ä—è–¥–æ–º —Å —ç—Ç–∏–º camera.html ‚Äî –æ—Å—Ç–∞–≤—å –∫–∞–∫ –µ—Å—Ç—å.
      –ï—Å–ª–∏ –ª–µ–∂–∏—Ç –≤ –ø–∞–ø–∫–µ targets/targets.mind ‚Äî –ø–æ—Å—Ç–∞–≤—å "./targets/targets.mind"
    ========================================================= */
    const TARGETS_PATH = "./targets.mind";

    /* =========================================================
      (2) –ù–ê–°–¢–†–û–ô–ö–ò: –≤–∏–¥–µ–æ –∏ –ø—Ä–∞–≤–∏–ª–∞ –∏–Ω–¥–µ–∫—Å–æ–≤
      –¢—ã –≥–æ–≤–æ—Ä–∏–ª:
        0..7   -> Bulygin
        8..14  -> Naumov
        15..24 -> Pchelin

      –í–∞–∂–Ω–æ:
      - –ª—É—á—à–µ —Ö—Ä–∞–Ω–∏—Ç—å mp4 –≤ –ø–∞–ø–∫–µ ./videos/ —Ä—è–¥–æ–º —Å camera.html
      - –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä—è–º–æ–π mp4 URL (–ù–ï github.com/blob)
    ========================================================= */
    const VIDEO_URLS = {
      bulygin: "./videos/bulygin.mp4",
      naumov:  "./videos/naumov.mp4",
      pchelin: "./videos/pchelin.mp4",
    };

    function groupByIndex(i){
      if (i >= 0 && i <= 7)  return "bulygin";
      if (i >= 8 && i <= 14) return "naumov";
      if (i >= 15 && i <= 24) return "pchelin";
      return null;
    }

    /* =========================================================
      (3) DOM —ç–ª–µ–º–µ–Ω—Ç—ã
    ========================================================= */
    const statusEl     = document.getElementById("status");
    const startOverlay = document.getElementById("startOverlay");
    const startBtn     = document.getElementById("startBtn");
    const reloadBtn    = document.getElementById("reloadBtn");

    const rotateHint   = document.getElementById("rotateHint");

    const videoFull    = document.getElementById("videoFull");
    const videoEl      = document.getElementById("arVideo");
    const videoTitleEl = document.getElementById("videoTitle");
    const videoHintEl  = document.getElementById("videoHint");

    const sceneEl      = document.getElementById("scene");
    const targetsRoot  = document.getElementById("targetsRoot");

    function setStatus(t){ statusEl.textContent = t; }

    /* =========================================================
      (4) –ü–æ–¥—Å–∫–∞–∑–∫–∞ ‚Äú–ø–µ—Ä–µ–≤–µ—Ä–Ω–∏ —Ç–µ–ª–µ—Ñ–æ–Ω‚Äù
      - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö —Å ‚Äúcoarse pointer‚Äù (–æ–±—ã—á–Ω–æ —Ç–µ–ª–µ—Ñ–æ–Ω/–ø–ª–∞–Ω—à–µ—Ç)
      - –∏ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–æ—Ä—Ç—Ä–µ—Ç–Ω–∞—è –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è
      - –≤–∫–ª—é—á–∞–µ–º –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ AR
    ========================================================= */
    let arStartedOnce = false;

    function isMobileLike(){
      return window.matchMedia && window.matchMedia("(pointer: coarse)").matches;
    }

    function isPortrait(){
      return window.matchMedia
        ? window.matchMedia("(orientation: portrait)").matches
        : (window.innerHeight > window.innerWidth);
    }

    function updateRotateHint(){
      if(!arStartedOnce){
        rotateHint.style.display = "none";
        return;
      }
      if(isMobileLike() && isPortrait()){
        rotateHint.style.display = "flex";
      }else{
        rotateHint.style.display = "none";
      }
    }

    window.addEventListener("resize", updateRotateHint);
    window.addEventListener("orientationchange", updateRotateHint);

    /* =========================================================
      (5) –ü—Ä–æ–≤–µ—Ä–∫–∞ targets.mind
    ========================================================= */
    async function checkTargetsFile(){
      // —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –ø—É—Ç—å –≤ –∞—Ç—Ä–∏–±—É—Ç–µ —Å—Ü–µ–Ω—ã (–≤–∞–∂–Ω–æ, –µ—Å–ª–∏ –º–µ–Ω—è–ª TARGETS_PATH)
      sceneEl.setAttribute(
        "mindar-image",
        `imageTargetSrc: ${TARGETS_PATH}; autoStart:false; uiScanning:false; uiError:false;`
      );

      try{
        const r = await fetch(TARGETS_PATH, { cache: "no-store" });
        if(!r.ok) throw new Error(`targets.mind HTTP ${r.status}`);
        return true;
      }catch(e){
        console.error(e);
        setStatus("targets.mind –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è ‚Äî –ø—Ä–æ–≤–µ—Ä—å –ø—É—Ç—å/–ø—É–±–ª–∏–∫–∞—Ü–∏—é");
        alert("targets.mind –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ —Ñ–∞–π–ª –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ HTTPS –∏ –ø—É—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π.");
        return false;
      }
    }

    /* =========================================================
      (6) –°–æ–∑–¥–∞–Ω–∏–µ targetIndex 0..24
    ========================================================= */
    function buildTargets(){
      targetsRoot.innerHTML = "";
      for(let i = 0; i <= 24; i++){
        const holder = document.createElement("a-entity");
        holder.setAttribute("mindar-image-target", `targetIndex: ${i}`);
        holder.addEventListener("targetFound", () => onFound(i));
        holder.addEventListener("targetLost",  () => onLost(i));
        targetsRoot.appendChild(holder);
      }
    }

    /* =========================================================
      (7) –í–∏–¥–µ–æ –ª–æ–≥–∏–∫–∞
      –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
      - –≤–∏–¥–µ–æ –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
      - –µ—Å–ª–∏ –º–µ—Ç–∫–∞ –ø–æ—Ç–µ—Ä—è–ª–∞—Å—å ‚Äî –≤–∏–¥–µ–æ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –∏–≥—Ä–∞—Ç—å
      - –µ—Å–ª–∏ –Ω–∞—à–ª–∏ –¥—Ä—É–≥—É—é –º–µ—Ç–∫—É —Ç–æ–π –∂–µ –≥—Ä—É–ø–ø—ã ‚Äî –Ω–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º
    ========================================================= */
    let currentGroup = null;
    let currentIndex = null;

    function openVideoUI(){
      videoFull.classList.add("isOpen");
    }

    async function onFound(idx){
      const group = groupByIndex(idx);
      if(!group){
        setStatus(`–ù–∞–π–¥–µ–Ω–∞ –º–µ—Ç–∫–∞ #${idx}, –Ω–æ –Ω–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ –≤–∏–¥–µ–æ`);
        return;
      }

      const src = VIDEO_URLS[group];
      currentGroup = group;
      currentIndex = idx;

      openVideoUI();

      videoTitleEl.innerHTML = `<b>${group}</b> (–º–µ—Ç–∫–∞ #${idx})`;
      videoHintEl.textContent = "–ú–µ—Ç–∫–∞ –Ω–∞–π–¥–µ–Ω–∞";
      setStatus(`–ú–µ—Ç–∫–∞ #${idx} ‚Äî –≤–∏–¥–µ–æ: ${group}`);

      // –ï—Å–ª–∏ —É–∂–µ –∏–≥—Ä–∞–µ—Ç —ç—Ç–æ –∂–µ –≤–∏–¥–µ–æ ‚Äî –Ω–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º
      // (videoEl.src —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∞–±—Å–æ–ª—é—Ç–Ω—ã–º, –ø–æ—ç—Ç–æ–º—É —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º –ø–æ "includes")
      if (videoEl.src && videoEl.src.includes(src) && !videoEl.paused){
        return;
      }

      // –ù–∞–∑–Ω–∞—á–∞–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫
      videoEl.src = src;

      // –ü—Ä–æ–±—É–µ–º autoplay (muted –ø–æ–º–æ–≥–∞–µ—Ç)
      try{
        await videoEl.play();
      }catch(e){
        console.error(e);
        // –ï—Å–ª–∏ autoplay –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–º—ë—Ç Play –≤ controls
        videoHintEl.textContent = "–ù–∞–∂–º–∏ Play";
        setStatus(`–ú–µ—Ç–∫–∞ #${idx} ‚Äî –Ω–∞–∂–º–∏ Play (–∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω)`);
      }
    }

    function onLost(idx){
      // –ù–ï –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤–∏–¥–µ–æ –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é
      if (idx === currentIndex){
        videoHintEl.textContent = "–ú–µ—Ç–∫–∞ –ø–æ—Ç–µ—Ä—è–Ω–∞ ‚Äî –≤–∏–¥–µ–æ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è";
        setStatus(`–ú–µ—Ç–∫–∞ #${idx} –ø–æ—Ç–µ—Ä—è–Ω–∞ ‚Äî –≤–∏–¥–µ–æ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è`);
      }
    }

    /* =========================================================
      (8) –ó–∞–ø—É—Å–∫ MindAR –ø–æ –∫–Ω–æ–ø–∫–µ
    ========================================================= */
    let running = false;

    async function startAR(){
      if (running) return;

      const ok = await checkTargetsFile();
      if(!ok) return;

      buildTargets();

      const mindar = sceneEl.systems["mindar-image-system"];
      if(!mindar){
        setStatus("MindAR system –Ω–µ –Ω–∞–π–¥–µ–Ω");
        alert("MindAR system –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ mindar-image-aframe.prod.js");
        return;
      }

      try{
        setStatus("–ó–∞–ø—É—Å–∫ –∫–∞–º–µ—Ä—ã‚Ä¶");
        await mindar.start();

        running = true;
        arStartedOnce = true;

        // –ø—Ä—è—á–µ–º –æ–≤–µ—Ä–ª–µ–π –∑–∞–ø—É—Å–∫–∞
        startOverlay.style.display = "none";

        // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É –ø–æ–≤–æ—Ä–æ—Ç–∞ (—Ç–æ–ª—å–∫–æ —Ç–µ–ª–µ—Ñ–æ–Ω + –ø–æ—Ä—Ç—Ä–µ—Ç)
        updateRotateHint();

        setStatus("–ö–∞–º–µ—Ä–∞ –∑–∞–ø—É—â–µ–Ω–∞ ‚Äî –Ω–∞–≤–µ–¥–∏ –Ω–∞ –º–µ—Ç–∫—É");
      }catch(e){
        console.error(e);
        setStatus(`–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–∞–º–µ—Ä—É: ${e?.name || "–æ—à–∏–±–∫–∞"}`);
        alert("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–∞–º–µ—Ä—É. –ü—Ä–æ–≤–µ—Ä—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∏ —á—Ç–æ –∫–∞–º–µ—Ä–∞ –Ω–µ –∑–∞–Ω—è—Ç–∞.");
      }
    }

    /* =========================================================
      (9) UI —Å–æ–±—ã—Ç–∏—è
    ========================================================= */
    reloadBtn.addEventListener("click", () => location.reload());
    startBtn.addEventListener("click", startAR);

    setStatus("–ù–∞–∂–º–∏—Ç–µ ¬´–ó–∞–ø—É—Å—Ç–∏—Ç—å AR¬ª");
  </script>
</body>
</html>
